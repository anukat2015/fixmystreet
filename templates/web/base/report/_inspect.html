[% PROCESS 'admin/report_blocks.html'; # For the report state dropdown %]
[% BLOCK second_column -%]
  <div id="side-report-secondary">
    <div class="problem-inspector-fields clearfix">
      <form id="report_inspect_form" method="post" action="[% c.uri_for( '/report', problem.id, 'inspect' ) %]">
        <p>
          <label>
            Report ID:
            <input type="text" readonly value="[% problem.id %]">
          </label>
        </p>
        <p>
          <label>
            Priority:
            <select name="priority">
              <option value="" [% 'selected' UNLESS problem.get_extra_metadata('priority') %]>-</option>
              [% FOREACH priority IN priorities %]
                <option value="[% priority.key %]" [% 'selected' IF problem.get_extra_metadata('priority') == priority.key %]>[% priority.value %]</option>
              [% END %]
            </select>
          </label>
        </p>
        <p>
          <label>
            State:
            [%# XXX this is duplicated from admin/report_edit.html, should be refactored %]
            <select name="state"  id="state">
              [% FOREACH group IN state_groups %]
                <optgroup label="[% group.0 %]">
                  [% FOREACH state IN group.1 %]
                    <option [% 'selected ' IF state == problem.state %] value="[% state %]">[% state_pretty.$state %]</option>
                  [% END %]
                </optgroup>
              [% END %]
            </select>
          </label>
        </p>
        <p>
          <label>
            Category:
            [%# XXX this is duplicated from admin/report_edit.html, should be refactored %]
            <select name="category" id="category">
              [% IF NOT problem.category OR NOT categories.grep(problem.category).size %]
              <optgroup label="[% loc('Existing category') %]">
                <option selected value="[% problem.category | html %]">[% (problem.category OR '-') | html %]</option>
              </optgroup>
              [% END %]
              [% IF categories.size %]
                <optgroup label="[% loc('Available categories') %]">
                  [% FOREACH cat IN categories %]
                    <option[% ' selected' IF problem.category == cat %]>[% cat | html %]</option>
                  [% END %]
                </optgroup>
              [% END %]
            </select>
          </label>
        </p>
        <p>
          <label>
            Longitude:
            <input type="text" name="longitude" value="[% problem.longitude %]" readonly>
          </label>
        </p>
        <p>
          <label>
            Latitude:
            <input type="text" name="latitude" value="[% problem.latitude %]" readonly>
          </label>
        </p>
        <p>
          <a href="#" id="geolocate_link">Use my current location</a>,
          or drag the pin on the map &raquo;
        </p>
        <p>
          <label>
            Detailed problem information:
            <textarea rows="2" name="detailed_information">[% problem.get_extra_metadata('detailed_information') | html %]</textarea>
          </label>
        </p>
        <p>
          <label>
            Traffic management information:
            <textarea rows="2" name="traffic_information">[% problem.get_extra_metadata('traffic_information') | html %]</textarea>
          </label>
        </p>
        <p>
          <input type="hidden" name="token" value="[% csrf_token %]">
          <input type="submit" value="Save changes" name="save" />
        </p>
      </form>
    </div>
  </div>
[%- END %]